<!DOCTYPE html>
<html lang="en">
  <head>
    <title>{{ title }}</title>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ag-grid-community@33.2.1/styles/ag-grid.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/ag-grid-community@33.2.1/styles/ag-theme-quartz.css"
    />
    <style>
      body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        margin: 2rem;
        line-height: 1.6;
      }

      .nav-select {
        padding: 8px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: #f8f8f8;
        min-width: 200px;
        margin-bottom: 2rem;
      }

      #myGrid {
        height: 600px;
        width: 100%;
      }

      .explanation {
        background-color: #f8f9fa;
        border-left: 4px solid #007bff;
        padding: 1rem 1.5rem;
        margin: 1.5rem 0;
        border-radius: 4px;
      }

      .explanation h2 {
        margin-top: 0;
        font-size: 1.2rem;
        color: #333;
      }

      .explanation p {
        margin: 0.5rem 0;
      }

      .explanation ul, .explanation ol {
        margin: 0.5rem 0;
        padding-left: 2rem;
      }

      .explanation code {
        background-color: #e9ecef;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-family: monospace;
      }

      .explanation strong {
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <main>
      <select class="nav-select" onchange="window.location.href=this.value">
        <option value="">Select a view...</option>
        {% for link in nav_links %}
        <option value="{{ link.url }}" {% if link.url == data_file %}selected{% endif %}>{{ link.display_name }}</option>
        {% endfor %}
      </select>
      
      <h1>{{ display_name }}</h1>

      {% if explanation %}
      <div class="explanation">
        {{ explanation | safe }}
      </div>
      {% endif %}

      <div id="myGrid" class="ag-theme-quartz-auto-dark"></div>
    </main>

    <script>
      // Initialize grid with loading state
      const columnDefs = {{ column_defs | tojson }};

      const gridOptions = {
        theme: "legacy",
        columnDefs: columnDefs,
        rowData: null,
        loading: true,
        defaultColDef: {
          sortable: true,
          filter: true,
          resizable: true
        },
        pagination: true,
        paginationPageSize: 100
      };

      const gridDiv = document.querySelector('#myGrid');
      const gridApi = agGrid.createGrid(gridDiv, gridOptions);

      // Fetch data and update grid
      fetch('{{ data_file }}')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          gridApi.setGridOption('rowData', data);
          gridApi.setGridOption('loading', false);
        })
        .catch(error => {
          console.error('Error loading data:', error);
          gridApi.setGridOption('loading', false);
          gridApi.setGridOption('overlayNoRowsTemplate',
            `<span style="padding: 10px; color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px;">
              Error loading data: ${error.message}
            </span>`
          );
          gridApi.showNoRowsOverlay();
        });
    </script>
  </body>
</html>
